<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	
xmlns:georss="http://www.georss.org/georss" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
>

<channel>
	<title>Raz &#8211; Raz</title>
	<atom:link href="https://blog.razb.me/author/raz/feed/" rel="self" type="application/rss+xml" />
	<link>https://blog.razb.me</link>
	<description>Computer stuff</description>
	<lastBuildDate>Sun, 13 Jan 2019 01:25:31 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.0.3</generator>

<image>
	<url>https://i2.wp.com/blog.razb.me/wp-content/uploads/2018/04/cropped-Untitled.png?fit=32%2C32&#038;ssl=1</url>
	<title>Raz &#8211; Raz</title>
	<link>https://blog.razb.me</link>
	<width>32</width>
	<height>32</height>
</image> 
<site xmlns="com-wordpress:feed-additions:1">108306310</site>	<item>
		<title>Spoofing URL previews</title>
		<link>https://blog.razb.me/spoofing-url-previews/</link>
		<comments>https://blog.razb.me/spoofing-url-previews/#respond</comments>
		<pubDate>Mon, 31 Dec 2018 09:38:02 +0000</pubDate>
		<dc:creator><![CDATA[Raz]]></dc:creator>
				<category><![CDATA[Social Media]]></category>
		<category><![CDATA[facebook]]></category>
		<category><![CDATA[imessage]]></category>
		<category><![CDATA[phishing]]></category>
		<category><![CDATA[reddit]]></category>
		<category><![CDATA[social media]]></category>
		<category><![CDATA[spoofing]]></category>
		<category><![CDATA[twitter]]></category>

		<guid isPermaLink="false">https://blog.razb.me/?p=333</guid>
		<description><![CDATA[The rise of social media has enabled us to share content with one another at an unprecedented rate. From Facebook to Twitter to Reddit to iMessage we&#8217;re sharing things that we&#8217;ve found on the internet more and more, so much so that it became difficult to decide what&#8217;s worth clicking<a class="moretag" href="https://blog.razb.me/spoofing-url-previews/"> Read more&#8230;</a>]]></description>
				<content:encoded><![CDATA[
<p>The rise of social media has enabled us to share content with one another at an unprecedented rate. From Facebook to Twitter to Reddit to iMessage we&#8217;re sharing things that we&#8217;ve found on the internet more and more, so much so that it became difficult to decide what&#8217;s worth clicking on and what isn&#8217;t when we&#8217;re being presented with vast amounts of content summarized in the form of a URL. To solve this problem, URL previews were created.</p>



<hr class="wp-block-separator"/>



<h4>So what is a URL preview?</h4>



<p>A URL preview is something which we&#8217;ve all seen while we browse the internet. Somebody shares a URL to some piece of content, usually a web page, and the social platform which we&#8217;re browsing automatically generates a preview of the content found at the URL. In the example Facebook post below, I am sharing a URL to one of my favourite games, RuneScape:</p>



<iframe src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Frazvan.mcbang%2Fposts%2F105811240495300&amp;width=500" width="500" height="491"></iframe>



<p>These previews are generally very helpful and provide us with rich context surrounding what sort of content we can expect to find if we were to actually click on the URL. In the example above, we get several pieces of information:</p>



<ul><li>A main picture which is supposed to depict what we might see when we click the link</li><li>The actual domain name which we can expect to find ourselves at when we click the link</li><li>A short textual description of what the web page is about</li></ul>



<p>Upon seeing the above post you might expect that clicking on the post will take you to <a href="http://runescape.com">runescape.com</a> and that the web page will look roughly as you expect it to look based on the preview provided by Facebook. However if you go ahead and actually click on the post above, you&#8217;ll find yourself at my proof-of-concept website instead: <a href="https://poc.razb.me">poc.razb.me</a></p>



<hr class="wp-block-separator"/>



<h4>How are URL previews created?</h4>



<p>In order to understand how a URL preview might be spoofed, we must first understand how a URL preview is created. I will be using Facebook as my example platform, but all platforms which provide this sort of preview will function in a similar manner.</p>



<p>There are really only three main steps in generating a URL preview:</p>



<ol><li>Download a copy of the web page found at the URL</li><li>Inspect it for various metadata tags</li><li>Generate the preview</li></ol>



<p>The first step should be pretty straightforward, just make a GET request to the URL and save the resulting HTML.</p>



<p>The second step is specific to the platform. Each platform defines its own set of metadata tags which can be added to the HTML of any webpage for providing information to be used for populating URL previews. You can find out all about these HTML tags here: <a href="https://developers.facebook.com/docs/sharing/webmasters/">https://developers.facebook.com/docs/sharing/webmasters/</a></p>



<p>The third step is to put together the information provided via the metadata tags into a visual format which becomes the URL preview.</p>



<hr class="wp-block-separator"/>



<h4>How can we spoof the preview generation?</h4>



<p>So far everything looks fine. I share a URL, Facebook fetches that web page and parses the HTML tags then generates the preview from them. How can we possibly spoof any of this? We don&#8217;t necessarily own the web page which we&#8217;re linking to, so what can we do?</p>



<p>Let&#8217;s try sharing a URL to a web page which we do own and check the GET request which Facebook makes.</p>



<p>Upon inspection, when Facebook makes a GET request to my proof-of-concept domain, the headers look something like this:</p>



<link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-d7f32d1731d95b9cb4d3c880c428c9e9.css">
<div id="gist93814398" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-facebook_header-json" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-json ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-facebook_header-json-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-facebook_header-json-LC1" class="blob-code blob-code-inner js-file-line">{</td>
      </tr>
      <tr>
        <td id="file-facebook_header-json-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-facebook_header-json-LC2" class="blob-code blob-code-inner js-file-line">	<span class="pl-s"><span class="pl-pds">&#8220;</span>Host<span class="pl-pds">&#8220;</span></span>: <span class="pl-s"><span class="pl-pds">&#8220;</span>poc.razb.me<span class="pl-pds">&#8220;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-facebook_header-json-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-facebook_header-json-LC3" class="blob-code blob-code-inner js-file-line">	<span class="pl-s"><span class="pl-pds">&#8220;</span>Connection<span class="pl-pds">&#8220;</span></span>: <span class="pl-s"><span class="pl-pds">&#8220;</span>Keep-Alive<span class="pl-pds">&#8220;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-facebook_header-json-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-facebook_header-json-LC4" class="blob-code blob-code-inner js-file-line">	<span class="pl-s"><span class="pl-pds">&#8220;</span>Accept-Encoding<span class="pl-pds">&#8220;</span></span>: <span class="pl-s"><span class="pl-pds">&#8220;</span>gzip<span class="pl-pds">&#8220;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-facebook_header-json-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-facebook_header-json-LC5" class="blob-code blob-code-inner js-file-line">	<span class="pl-s"><span class="pl-pds">&#8220;</span>Accept<span class="pl-pds">&#8220;</span></span>: <span class="pl-s"><span class="pl-pds">&#8220;</span>*<span class="pl-cce">\\</span>/*<span class="pl-pds">&#8220;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-facebook_header-json-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-facebook_header-json-LC6" class="blob-code blob-code-inner js-file-line">	<span class="pl-s"><span class="pl-pds">&#8220;</span>User-Agent<span class="pl-pds">&#8220;</span></span>: <span class="pl-s"><span class="pl-pds">&#8220;</span>facebookexternalhit<span class="pl-cce">\\</span>/1.1 (+http:<span class="pl-cce">\\</span>/<span class="pl-cce">\\</span>/<a class="vglnk" href="http://www.facebook.com" rel="nofollow"><span>www</span><span>.</span><span>facebook</span><span>.</span><span>com</span></a><span class="pl-cce">\\</span>/externalhit_uatext.php)<span class="pl-pds">&#8220;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-facebook_header-json-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-facebook_header-json-LC7" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/Raztor0/e57f5fd2fd26df06fc32d73894956ebf/raw/3456fd805c0e2f2dcb42e38315a6924170e97e84/facebook_header.json" style="float:right">view raw</a>
        <a href="https://gist.github.com/Raztor0/e57f5fd2fd26df06fc32d73894956ebf#file-facebook_header-json">facebook_header.json</a>
        hosted with <img draggable="false" class="emoji" alt="&#x2764;" src="https://s.w.org/images/core/emoji/11/svg/2764.svg" scale="0"> by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div>



<p>The field worth noting is the &#8220;User-Agent&#8221; field. This is used as a courtesy by the client requesting our web page and it lets us know what sort of browser (or in this case bot) was used to access our web page.</p>



<p>In the case of the Facebook URL preview generation, Facebook&#8217;s bot configured the &#8220;User-Agent&#8221; field to something specific to their use case and they call it &#8220;facebookexternalhit&#8221;.</p>



<p>For a normal user like you or I requesting my web page, the header will look something like this:</p>



<link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-d7f32d1731d95b9cb4d3c880c428c9e9.css">
<div id="gist93814446" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-normal_header-json" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-json ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-normal_header-json-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-normal_header-json-LC1" class="blob-code blob-code-inner js-file-line">{</td>
      </tr>
      <tr>
        <td id="file-normal_header-json-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-normal_header-json-LC2" class="blob-code blob-code-inner js-file-line">	<span class="pl-s"><span class="pl-pds">&#8220;</span>Host<span class="pl-pds">&#8220;</span></span>: <span class="pl-s"><span class="pl-pds">&#8220;</span>poc.razb.me<span class="pl-pds">&#8220;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-normal_header-json-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-normal_header-json-LC3" class="blob-code blob-code-inner js-file-line">	<span class="pl-s"><span class="pl-pds">&#8220;</span>Connection<span class="pl-pds">&#8220;</span></span>: <span class="pl-s"><span class="pl-pds">&#8220;</span>Keep-Alive<span class="pl-pds">&#8220;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-normal_header-json-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-normal_header-json-LC4" class="blob-code blob-code-inner js-file-line">	<span class="pl-s"><span class="pl-pds">&#8220;</span>Accept-Encoding<span class="pl-pds">&#8220;</span></span>: <span class="pl-s"><span class="pl-pds">&#8220;</span>gzip<span class="pl-pds">&#8220;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-normal_header-json-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-normal_header-json-LC5" class="blob-code blob-code-inner js-file-line">	<span class="pl-s"><span class="pl-pds">&#8220;</span>User-Agent<span class="pl-pds">&#8220;</span></span>: <span class="pl-s"><span class="pl-pds">&#8220;</span>Mozilla<span class="pl-cce">\\</span>/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit<span class="pl-cce">\\</span>/537.36 (KHTML, like Gecko) Chrome<span class="pl-cce">\\</span>/71.0.3578.98 Safari<span class="pl-cce">\\</span>/537.36<span class="pl-pds">&#8220;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-normal_header-json-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-normal_header-json-LC6" class="blob-code blob-code-inner js-file-line">}</td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/Raztor0/206175807d0f9d4ab26dc1bac4ac7dc5/raw/d7e5cfaefd43bc7e1180c0113b68258508ea4add/normal_header.json" style="float:right">view raw</a>
        <a href="https://gist.github.com/Raztor0/206175807d0f9d4ab26dc1bac4ac7dc5#file-normal_header-json">normal_header.json</a>
        hosted with <img draggable="false" class="emoji" alt="&#x2764;" src="https://s.w.org/images/core/emoji/11/svg/2764.svg" scale="0"> by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div>



<p>In the normal case, the &#8220;User-Agent&#8221; field looks very different and actually contains information about the browser which I used to access my web page.</p>



<p>It turns out that we can use this subtle difference in User-Agent to serve Facebook&#8217;s bot a different response than we serve normal users.</p>



<hr class="wp-block-separator"/>



<h4>User-Agent switching</h4>



<p>If for every request we read the User-Agent field before serving our web page, we can switch on the User-Agent value to serve different responses for bots and for regular users.</p>



<p>So what might we do differently for a bot so that it generates a preview for something other than our current web page? A simple solution is to simply return a 300 redirect to your target web page of choice.</p>



<p>Here is some sample code which can do just that in PHP:</p>



<link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-d7f32d1731d95b9cb4d3c880c428c9e9.css">
<div id="gist93814546" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-fb_bot_redirect-php" class="file">
    

  <div itemprop="text" class="blob-wrapper data type-php ">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-fb_bot_redirect-php-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-fb_bot_redirect-php-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span></td>
      </tr>
      <tr>
        <td id="file-fb_bot_redirect-php-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-fb_bot_redirect-php-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-s1"></span></td>
      </tr>
      <tr>
        <td id="file-fb_bot_redirect-php-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-fb_bot_redirect-php-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-s1"><span class="pl-smi">$user_agent</span> <span class="pl-k">=</span> <span class="pl-smi">$_SERVER</span>[<span class="pl-s"><span class="pl-pds">&#8220;</span>HTTP_USER_AGENT<span class="pl-pds">&#8220;</span></span>];</span></td>
      </tr>
      <tr>
        <td id="file-fb_bot_redirect-php-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-fb_bot_redirect-php-LC4" class="blob-code blob-code-inner js-file-line"><span class="pl-s1"></span></td>
      </tr>
      <tr>
        <td id="file-fb_bot_redirect-php-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-fb_bot_redirect-php-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-s1"><span class="pl-k">if</span> (<span class="pl-c1">strpos</span>(<span class="pl-smi">$user_agent</span>, <span class="pl-s"><span class="pl-pds">&#8220;</span>facebookexternalhit<span class="pl-pds">&#8220;</span></span>) <span class="pl-k">!</span><span class="pl-k">==</span> <span class="pl-c1">false</span>) {</span></td>
      </tr>
      <tr>
        <td id="file-fb_bot_redirect-php-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-fb_bot_redirect-php-LC6" class="blob-code blob-code-inner js-file-line"><span class="pl-s1">    <span class="pl-c1">header</span>(<span class="pl-s"><span class="pl-pds">&#8220;</span>Location: <a class="vglnk" href="https://runescape.com" rel="nofollow"><span>https</span><span>://</span><span>runescape</span><span>.</span><span>com</span></a><span class="pl-pds">&#8220;</span></span>);</span></td>
      </tr>
      <tr>
        <td id="file-fb_bot_redirect-php-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-fb_bot_redirect-php-LC7" class="blob-code blob-code-inner js-file-line"><span class="pl-s1">} <span class="pl-k">else</span> {</span></td>
      </tr>
      <tr>
        <td id="file-fb_bot_redirect-php-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-fb_bot_redirect-php-LC8" class="blob-code blob-code-inner js-file-line"><span class="pl-s1">  <span class="pl-c1">echo</span>(<span class="pl-s"><span class="pl-pds">&#8220;</span>poc.razb.me<span class="pl-pds">&#8220;</span></span>);</span></td>
      </tr>
      <tr>
        <td id="file-fb_bot_redirect-php-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-fb_bot_redirect-php-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-s1">}</span></td>
      </tr>
      <tr>
        <td id="file-fb_bot_redirect-php-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-fb_bot_redirect-php-LC10" class="blob-code blob-code-inner js-file-line"><span class="pl-s1"></span></td>
      </tr>
      <tr>
        <td id="file-fb_bot_redirect-php-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-fb_bot_redirect-php-LC11" class="blob-code blob-code-inner js-file-line"><span class="pl-s1"></span><span class="pl-pse"><span class="pl-s1">?</span>&gt;</span></td>
      </tr>
</tbody></table>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/Raztor0/9573dcac3b76c446db9aa1a07760a0db/raw/26b6ce3e2ffe2f86c7ac2fd24eb6d3841c25fc82/fb_bot_redirect.php" style="float:right">view raw</a>
        <a href="https://gist.github.com/Raztor0/9573dcac3b76c446db9aa1a07760a0db#file-fb_bot_redirect-php">fb_bot_redirect.php</a>
        hosted with <img draggable="false" class="emoji" alt="&#x2764;" src="https://s.w.org/images/core/emoji/11/svg/2764.svg" scale="0"> by <a href="https://github.com">GitHub</a>
      </div>
    </div>
</div>



<p>In this example we simply set the &#8220;Location&#8221; header response to <a href="https://runescape.com">https://runescape.com</a>. This will tell Facebook&#8217;s bot to ignore whatever content it found at my URL poc.razb.me, and instead go looking at runescape.com. We can confirm that the bot is doing what we expect by using Facebook&#8217;s sharing debugger: <a href="https://developers.facebook.com/tools/debug/sharing/?q=https%3A%2F%2Fpoc.razb.me">https://developers.facebook.com/tools/debug/sharing/?q=https%3A%2F%2Fpoc.razb.me</a></p>



<p>It turns out this is all it takes to spoof the Facebook URL preview bot. It is also possible to perform the same simple switch on iMessage, Twitter, and Reddit previews. Here are some examples:</p>



<div class="wp-block-image"><figure class="alignleft"><img data-attachment-id="345" data-permalink="https://blog.razb.me/spoofing-url-previews/imessage_spoof/" data-orig-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2018/12/imessage_spoof.png?fit=618%2C456&amp;ssl=1" data-orig-size="618,456" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="imessage_spoof" data-image-description="" data-medium-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2018/12/imessage_spoof.png?fit=300%2C221&amp;ssl=1" data-large-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2018/12/imessage_spoof.png?fit=618%2C456&amp;ssl=1" src="https://i2.wp.com/blog.razb.me/wp-content/uploads/2018/12/imessage_spoof.png?w=750&#038;ssl=1" alt="" class="wp-image-345" srcset="https://i2.wp.com/blog.razb.me/wp-content/uploads/2018/12/imessage_spoof.png?w=618&amp;ssl=1 618w, https://i2.wp.com/blog.razb.me/wp-content/uploads/2018/12/imessage_spoof.png?resize=300%2C221&amp;ssl=1 300w" sizes="(max-width: 618px) 100vw, 618px" data-recalc-dims="1" /><figcaption>iMessage preview spoof<br></figcaption></figure></div>





<figure class="wp-block-image"><img data-attachment-id="346" data-permalink="https://blog.razb.me/spoofing-url-previews/image/" data-orig-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2018/12/image.png?fit=936%2C166&amp;ssl=1" data-orig-size="936,166" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="image" data-image-description="" data-medium-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2018/12/image.png?fit=300%2C53&amp;ssl=1" data-large-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2018/12/image.png?fit=750%2C133&amp;ssl=1" src="https://i1.wp.com/blog.razb.me/wp-content/uploads/2018/12/image.png?w=750&#038;ssl=1" alt="" class="wp-image-346" srcset="https://i1.wp.com/blog.razb.me/wp-content/uploads/2018/12/image.png?w=936&amp;ssl=1 936w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2018/12/image.png?resize=300%2C53&amp;ssl=1 300w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2018/12/image.png?resize=768%2C136&amp;ssl=1 768w" sizes="(max-width: 750px) 100vw, 750px" data-recalc-dims="1" /><figcaption>Reddit preview spoof</figcaption></figure>



<figure class="wp-block-image"><img data-attachment-id="463" data-permalink="https://blog.razb.me/spoofing-url-previews/spoof_tweet/" data-orig-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2019/01/spoof_tweet.png?fit=1284%2C788&amp;ssl=1" data-orig-size="1284,788" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="spoof_tweet" data-image-description="" data-medium-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2019/01/spoof_tweet.png?fit=300%2C184&amp;ssl=1" data-large-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2019/01/spoof_tweet.png?fit=750%2C460&amp;ssl=1" src="https://i0.wp.com/blog.razb.me/wp-content/uploads/2019/01/spoof_tweet.png?fit=750%2C460&amp;ssl=1" alt="" class="wp-image-463" srcset="https://i0.wp.com/blog.razb.me/wp-content/uploads/2019/01/spoof_tweet.png?w=1284&amp;ssl=1 1284w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2019/01/spoof_tweet.png?resize=300%2C184&amp;ssl=1 300w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2019/01/spoof_tweet.png?resize=768%2C471&amp;ssl=1 768w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2019/01/spoof_tweet.png?resize=1024%2C628&amp;ssl=1 1024w" sizes="(max-width: 750px) 100vw, 750px" /><figcaption>Twitter preview spoof<br><a href="https://twitter.com/test_raz/status/1079640248743837696">https://twitter.com/test_raz/status/1079640248743837696</a></figcaption></figure>



<p>It&#8217;s important to note that both iMessage and Reddit actually preserve the original URL when generating the preview. This is a very good practise as it makes this sort of attack much less effective when the user can still see the original URL.</p>



<p>However, in the case of Facebook and Twitter they use the redirected URL in the preview and omit the original URL entirely. This makes it possible to trick somebody into thinking that they are about to go to one domain when in fact they will be taken to another.</p>



<hr class="wp-block-separator"/>



<h4>Responsible Disclosure</h4>



<p>Prior to posting this blog post, I reached out to Facebook and Twitter (via their respective bug bounty programs <a href="https://www.facebook.com/whitehat">here</a> and <a href="https://hackerone.com/twitter">here</a>) and made sure that they are aware of the trick that I outlined in this post. They both got back to me and said that it is too low risk and they have no plans on changing the current behaviour.</p>



<p>So for the time being, pay extra close attention when clicking on content on Facebook and Twitter, and make sure the domain you end up at is the one you expected.</p>
]]></content:encoded>
			<wfw:commentRss>https://blog.razb.me/spoofing-url-previews/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">333</post-id>	</item>
		<item>
		<title>Pulling apart an iOS App</title>
		<link>https://blog.razb.me/pulling-apart-an-ios-app/</link>
		<comments>https://blog.razb.me/pulling-apart-an-ios-app/#respond</comments>
		<pubDate>Fri, 29 Dec 2017 20:38:13 +0000</pubDate>
		<dc:creator><![CDATA[Raz]]></dc:creator>
				<category><![CDATA[iOS]]></category>
		<category><![CDATA[Objective-C]]></category>
		<category><![CDATA[Swift]]></category>

		<guid isPermaLink="false">https://blog.razb.me/?p=160</guid>
		<description><![CDATA[The App Store Since its initial release on July 10, 2008, the iOS App Store has amassed over 2.2 million apps. Combine that with a study by Nielsen in 2015 which shows that the average smartphone user interacts with 10 apps a day, and 30 apps a month for a<a class="moretag" href="https://blog.razb.me/pulling-apart-an-ios-app/"> Read more&#8230;</a>]]></description>
				<content:encoded><![CDATA[<h1>The App Store</h1>
<p>Since its initial release on July 10, 2008, the iOS App Store has amassed <a href="https://en.wikipedia.org/wiki/App_Store_(iOS)#Number_of_iOS_applications">over 2.2 million apps</a>. Combine that with <a href="http://www.nielsen.com/us/en/insights/news/2015/so-many-apps-so-much-more-time-for-entertainment.html">a study by Nielsen in 2015</a> which shows that the average smartphone user interacts with 10 apps a day, and 30 apps a month for a total of over 35 hours spent using apps every month, it&#8217;s safe to say that we love our apps.</p>
<p>The way we interact with all of these apps is generally the same: download it from the App Store, find the app&#8217;s icon on your home screen, tap it and it magically opens. On the surface, there doesn&#8217;t seem much to an app. They all just sit there patiently on your home screen, icons waiting for you to tap on them and bring them to life. But have you ever wondered what actually goes on under the hood? How these apps work, and what they&#8217;re made of? Let&#8217;s take a look.</p>
<blockquote><p><strong>Note:</strong>&nbsp;throughout this post we will be looking at specific examples from an app which I wrote: <a href="https://itunes.apple.com/us/app/rs-xchange/id1018629772">RS Xchange</a>.</p></blockquote>
<h1>The IPA file</h1>
<p>After finding a new app which you&#8217;d like to try out on the App Store, you press the download button and wait a little while for stuff to happen. During this time, iOS is downloading the app in the form of a file with an extension of &#8220;.ipa&#8221;. So what exactly is this &#8220;.ipa&#8221; file?</p>
<p>&#8220;.ipa&#8221; files are actually just &#8220;.zip&#8221; files. Renaming .ipa to .zip will allow you to extract the contents of the .ipa file in much the same way you extract .zip files. After extraction, you will find a folder with the following structure:</p>
<ul>
<li>iTunesArtwork</li>
<li>iTunesMetadata.plist</li>
<li>Payload/</li>
<li>META-INF/</li>
</ul>
<p>Let&#8217;s run through this from top to bottom.</p>
<h2>iTunesArtwork</h2>
<p>This file is actually a .png file. Adding the &#8220;.png&#8221; extension to it will allow you to open the file with your image viewing tool of choice. Upon opening the file, you will see that this is just the app&#8217;s icon as it is shown on the App Store. This image will have a size of 1024&#215;1024. Here is an example of an&nbsp;<em>iTunesArtwork</em> file:</p>
<p><div id="attachment_280" style="width: 159px" class="wp-caption aligncenter"><img data-attachment-id="280" data-permalink="https://blog.razb.me/pulling-apart-an-ios-app/itunesartwork/" data-orig-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/iTunesArtwork.png?fit=1024%2C1024&amp;ssl=1" data-orig-size="1024,1024" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="iTunesArtwork" data-image-description="&lt;p&gt;iTunesArtwork&lt;/p&gt;
" data-medium-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/iTunesArtwork.png?fit=300%2C300&amp;ssl=1" data-large-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/iTunesArtwork.png?fit=750%2C750&amp;ssl=1" src="https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/iTunesArtwork.png?resize=149%2C149&#038;ssl=1" alt="iTunesArtwork" width="149" height="149" class=" wp-image-280" srcset="https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/iTunesArtwork.png?w=1024&amp;ssl=1 1024w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/iTunesArtwork.png?resize=150%2C150&amp;ssl=1 150w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/iTunesArtwork.png?resize=300%2C300&amp;ssl=1 300w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/iTunesArtwork.png?resize=768%2C768&amp;ssl=1 768w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/iTunesArtwork.png?resize=50%2C50&amp;ssl=1 50w" sizes="(max-width: 149px) 100vw, 149px" data-recalc-dims="1" /><p class="wp-caption-text">iTunesArtwork for the RS Xchange app</p></div></p>
<h2>iTunesMetadata.plist</h2>
<p>This file contains lots of information about the app, its developer, when it was downloaded, and which account it was downloaded by. This is what a sample iTunesMetadata.plist file might look like:</p>
<p><script src="https://gist.github.com/Raztor0/815ad9ad23bcf524bdc88357d5e9a5a4.js"></script></p>
<h2>Payload/</h2>
<p>The <em>Payload/</em> folder contains the actual app binary along with all of its resources that it needs to function. Once inside the&nbsp;<em>Payoad/</em> folder, there will be a single file with the &#8220;.app&#8221; extension. This file is actually just another folder, and you can open it like any other folder. On MacOS, right click it and press &#8220;Show Package Contents&#8221;.</p>
<p>The contents of this folder will differ from app to app. This is the stuff that defines each individual app. Here is an example of some of the things you might find:</p>
<ul>
<li>AppIcon29x29.png</li>
<li>AppIcon29x29@2x.png</li>
<li>AppIcon29x29@2x~ipad.png</li>
<li>AppIcon29x29@3x.png</li>
<li>AppIcon29x29~ipad.png</li>
<li>AppIcon40x40@2x.png</li>
<li>AppIcon40x40@2x~ipad.png</li>
<li>AppIcon40x40@3x.png</li>
<li>AppIcon40x40~ipad.png</li>
<li>AppIcon50x50@2x~ipad.png</li>
<li>AppIcon50x50~ipad.png</li>
<li>AppIcon57x57.png</li>
<li>AppIcon57x57@2x.png</li>
<li>AppIcon60x60@2x.png</li>
<li>AppIcon60x60@3x.png</li>
<li>AppIcon72x72@2x~ipad.png</li>
<li>AppIcon72x72~ipad.png</li>
<li>AppIcon76x76@2x~ipad.png</li>
<li>AppIcon76x76~ipad.png</li>
<li>Assets.car</li>
<li>Base.lproj/</li>
<li>Frameworks/</li>
<li>Info.plist</li>
<li>ItemDetailsStoryboard.storyboardc/</li>
<li>LaunchScreen.storyboardc/</li>
<li>OSRSItemDetailsDescriptionTableViewCell.nib</li>
<li>OSRSItemDetailsHeaderView.nib</li>
<li>OSRSItemDetailsWikiaTableViewCell.nib</li>
<li>OSRSItemSearchTableViewCell.nib</li>
<li>PkgInfo</li>
<li>RS Xchange</li>
<li>SC_Info/</li>
<li>TSMessagesDefaultDesign.json</li>
<li>_CodeSignature/</li>
<li>archived-expanded-entitlements.xcent</li>
</ul>
<p>Let&#8217;s run through them top to bottom.</p>
<h3>AppIcon.png</h3>
<p>First, you will notice a bunch of images named something like &#8220;AppIcon&lt;something&gt;.png&#8221;. These images correspond to, as you might have guessed, the app&#8217;s icon as you see it on your home screen. There are lots of various sizes of this icon, each one optimized for a different device and different place that it might be shown. For example, iPads have different app icon dimension requirements than iPhones, and the app icon as it is shown in a notification has a different dimension requirement than the app icon which is shown on the home screen.</p>
<h3>Assets.car</h3>
<p>This file contains some (or all) of the images which the app might use to display once you open it. The images are stored in an optimized format, and you need special tools to take them out and look at them one by one. One such tool which can do this is called the <a href="https://github.com/insidegui/AssetCatalogTinkerer">Asset Catalog Tinkerer</a>. Upon exporting, you will get a list of image files which you can open with your image viewing tool of choice. Here is an example of some of the images which you might find inside of the&nbsp;<em>Assets.car</em> file:</p>
<p> [<a href="https://blog.razb.me/pulling-apart-an-ios-app/">See image gallery at blog.razb.me</a>] </p>
<h3></h3>
<h3>Base.lproj/</h3>
<p>This folder has to do with localization. If an app supports multiple languages, each resource which needs to be translated (strings, images, storyboards, xibs) will go into its own folder which ends in &#8220;.lproj&#8221;. For example, if your app was localized to english and french, you will have three &#8220;.lproj&#8221; folders: en.lproj, fr.lproj, and Base.lproj. The en.lproj and fr.lproj folders will contain resources which have been converted to their respective languages, and Base.lproj contains the default resources to use in the case when a user&#8217;s phone is using a language which is not supported by the app. In most cases, Base.lproj just contains the english version of the app&#8217;s resources.</p>
<h3>Frameworks/</h3>
<p>This folder contains all of the dynamic frameworks and libraries which the app relies on. This is just some code which was written outside of the main app, and which is used by the main app. Here is an example of some of the files which might be found in this folder:</p>
<ul>
<li>AFNetworking.framework/</li>
<li>Blindside.framework/</li>
<li>BlindsidedStoryboard.framework/</li>
<li>ChameleonFramework.framework/</li>
<li>Charts.framework/</li>
<li>DZNEmptyDataSet.framework/</li>
<li>FontAwesome_iOS.framework/</li>
<li>Harpy.framework/</li>
<li>HexColors.framework/</li>
<li>KSDeferred.framework/</li>
<li>MaryPopin.framework/</li>
<li>NXTSegmentedControl.framework/</li>
<li>PPiAwesomeButton.framework/</li>
<li>PPiFlatSegmentedControl.framework/</li>
<li>SCLAlertView_Objective_C.framework/</li>
<li>SDWebImage.framework/</li>
<li>TSMessages.framework/</li>
<li>iRate.framework/</li>
<li>libswiftContacts.dylib</li>
<li>libswiftCore.dylib</li>
<li>libswiftCoreGraphics.dylib</li>
<li>libswiftCoreImage.dylib</li>
<li>libswiftDarwin.dylib</li>
<li>libswiftDispatch.dylib</li>
<li>libswiftFoundation.dylib</li>
<li>libswiftObjectiveC.dylib</li>
<li>libswiftUIKit.dylib</li>
</ul>
<p>Amongst these, you&#8217;ll notice that some apps contain files which start with &#8220;libswift&#8221;, and have the extension &#8220;.dylib&#8221;. These files make up the Swift runtime, and they are necessary to be included in every app which contains <a href="https://developer.apple.com/swift/">Swift</a> code.</p>
<h3>Info.plist</h3>
<p>This file contains generic information about the app itself. Things ranging from the app&#8217;s name, to the AppIcon files we talked about above, to the permissions which the app might ask for (photos, camera, contacts, etc), and even some internal information such as the unique identifier for the app (called the bundle identifier). Here is a sample <em>Info.plist</em> file:</p>
<p><script src="https://gist.github.com/Raztor0/6b2615434ef3e4c86341ad0eb5017f27.js"></script></p>
<p>A lot of interesting information can be found in the&nbsp;<em>Info.plist</em> file. An official summary of everything this file might contain can be found <a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Introduction/Introduction.html">here</a>&nbsp;and <a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/iPhoneOSKeys.html#//apple_ref/doc/uid/TP40009252-SW1">here</a>.</p>
<h2>&lt;something&gt;.storyboardc/</h2>
<p>Folders which end in&nbsp;<em>.storyboardc</em> contain some information related to the layout of particular screens or views within the app. The presence of these folders indicate that the app was developed using the <a href="https://developer.apple.com/xcode/interface-builder/">Interface Builder tool</a>. Within these folders, you will find several <em>.nib</em> files along with another&nbsp;<em>Info.plist</em> file:</p>
<ul>
<li>Info.plist</li>
<li>UIViewController-x1L-Z2-jkR.nib</li>
<li>x1L-Z2-jkR-view-7LY-9B-3EQ.nib</li>
</ul>
<p>The <em>Info.plist</em> file included here is in binary format, and you need to convert it to XML format before being able to read it like normal&nbsp;<em>.plist</em> files. Run this command to convert it to XML:</p><pre class="crayon-plain-tag">plutil -convert xml1 Info.plist</pre><p>Here is what an example <em>Info.plist</em> file could look like inside of a <em>.storyboardc</em> file:</p>
<p><script src="https://gist.github.com/Raztor0/9c1329ac54e2551df0808f1019275691.js"></script></p>
<p>The keys/values within these&nbsp;<em>Info.plist</em> files describe some information relating to the&nbsp;<em>.nib</em> files found alongside them. In this case, the&nbsp;<em>UIStoryboardDesignatedEntryPointIdentifier</em> key is indicating that the view controller with the identifier&nbsp;<em>UIViewController-x1L-Z2-jkR</em> is to be used as the &#8220;entry point&#8221; for the application, or the first screen to be displayed when the app is opened. The&nbsp;<em>UIViewControllerIdentifiersToNibNames</em> key is mapping identifiers in the compiled&nbsp;<em>.nib</em> files to other&nbsp;<em>.nib&nbsp;</em>files.</p>
<h2>&lt;something&gt;.nib</h2>
<p><em>.nib</em> files are the result of compiling&nbsp;<em>.xib</em> files using the <a href="https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/ibtool.1.html">ibtool</a> utility.&nbsp;<em>.xib</em> files are XML files which define the user interface for a specific element within the app. Everything from individual buttons to entire screens can be defined in <em>.xib</em> files. Here is a sample&nbsp;<em>.xib</em> file:</p>
<p><script src="https://gist.github.com/Raztor0/67a944fc3ede0ce66df9fb306d2e98bb.js"></script></p>
<p>And the corresponding user interface it produces:</p>
<p><div id="attachment_272" style="width: 409px" class="wp-caption alignnone"><img data-attachment-id="272" data-permalink="https://blog.razb.me/pulling-apart-an-ios-app/screen-shot-2017-12-29-at-7-46-25-pm/" data-orig-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2017/12/Screen-Shot-2017-12-29-at-7.46.25-PM.png?fit=724%2C198&amp;ssl=1" data-orig-size="724,198" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title=".xib user interface" data-image-description="&lt;p&gt;.xib user interface&lt;/p&gt;
" data-medium-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2017/12/Screen-Shot-2017-12-29-at-7.46.25-PM.png?fit=300%2C82&amp;ssl=1" data-large-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2017/12/Screen-Shot-2017-12-29-at-7.46.25-PM.png?fit=724%2C198&amp;ssl=1" src="https://i2.wp.com/blog.razb.me/wp-content/uploads/2017/12/Screen-Shot-2017-12-29-at-7.46.25-PM.png?resize=399%2C109&#038;ssl=1" alt=".xib user interface" width="399" height="109" class=" wp-image-272" srcset="https://i2.wp.com/blog.razb.me/wp-content/uploads/2017/12/Screen-Shot-2017-12-29-at-7.46.25-PM.png?w=724&amp;ssl=1 724w, https://i2.wp.com/blog.razb.me/wp-content/uploads/2017/12/Screen-Shot-2017-12-29-at-7.46.25-PM.png?resize=300%2C82&amp;ssl=1 300w" sizes="(max-width: 399px) 100vw, 399px" data-recalc-dims="1" /><p class="wp-caption-text">.xib user interface</p></div></p>
<p>It&#8217;s important to note that while developing, the XML of a&nbsp;<em>.xib</em> file is never modified directly by a person. The resulting XML is generated through the Interface Builder tool.</p>
<h2>PkgInfo</h2>
<p>This is an auto-generated file which contains&nbsp;<span>the 4-byte package type followed by the 4-byte signature of your application. For iOS apps, the package type will be &#8220;<em>APPL</em>&#8220;, and the signature will be <em>0x3f3f3f3f</em>.<br />
More information about this file can be found <a href="https://developer.apple.com/library/content/documentation/MacOSX/Conceptual/BPRuntimeConfig/Articles/ConfigApplications.html">here</a>.</span></p>
<h2>RS Xchange</h2>
<p>This file name will be different from app to app, and the name corresponds to the value for the&nbsp;<em>CFBundleExecutable</em> in the <em>Info.plist</em> file. This is the app&#8217;s main executable. It contains all of the code necessary to make the app run. This is the file that gets executed when you tap on the app&#8217;s icon on your home screen.</p>
<p>When you download an&nbsp;<em>.ipa</em> file from the App Store, this executable is encrypted, so you can&#8217;t take a closer look at what&#8217;s inside of it. Fortunately there is a way to get the decrypted version, but we&#8217;ll cover that in a future blog post.</p>
<h2>SC_Info/</h2>
<p>This folder contains keys which are used for decrypting the app executables. The contents will look like this:</p>
<ul>
<li>Manifest.plist</li>
<li>RS Xchange.sinf</li>
<li>RS Xchange.supf</li>
<li>RS Xchange.supp</li>
<li>RS Xchange.supx</li>
</ul>
<p>The&nbsp;<em>.sinf, .supf, .supp, .supx</em> files are used for decrypting, and the&nbsp;<em>Manifest.plist</em> file is used to list all of the relevant&nbsp;<em>.sinf</em> files which are to be used. Here is a sample&nbsp;<em>Manifest.plist</em> file:</p>
<p><script src="https://gist.github.com/Raztor0/8ce840b0841b8639ff453eb1f4435865.js"></script></p>
<h2>TSMessagesDefaultDesign.json</h2>
<p>This file is specific to the RS Xchange app which we have been inspecting throughout this post. It is just one of the additional resources which are included with the app. Apps can have all sorts of arbitrary resources which they require to function, and you will find them all in the root of the&nbsp;<em>.app</em> folder.</p>
<h2>_CodeSignature/</h2>
<p>This folder contains information related to <a href="https://en.wikipedia.org/wiki/Code_signing">code signing</a>. When a developer decides to distribute an app via the App Store, code signing is performed on the executable and all of the other resources included within the app. The purpose of this process is to ensure that the app can not be modified by any malicious third party after the developer has chosen to distribute a version of their app.</p>
<p>There is a single file within this folder called&nbsp;<em>CodeResources</em>. Taking a closer look at this file, it is actually a&nbsp;<em>.plist</em>, and can be opened the same way as any other&nbsp;<em>.plist</em> file. You can find a sample&nbsp;<em>CodeResources</em> file <a href="https://gist.github.com/Raztor0/cbb627ebb650a40dd59f88ae095bd4ef#file-coderesources">here</a>. (I would include it directly here, but it&#8217;s 3000+ lines long)</p>
<p>Each file which is eligible for code signing is included in this file, along with the corresponding hash data which should result from the process of signing each file.</p>
<p>If any of these files are modified after the developer has signed it, the hashes of the files will differ and the app will be unable to be run on a device.</p>
<p>More information about code signing can be found <a href="https://developer.apple.com/library/content/documentation/Security/Conceptual/CodeSigningGuide/AboutCS/AboutCS.html">here</a> and <a href="https://developer.apple.com/support/code-signing/">here</a>.</p>
<h2>archived-expanded-entitlements.xcent</h2>
<p>This file is once again just a&nbsp;<em>.plist</em> file in disguise. It contains all of the entitlements which the app has requested, such as push notifications and access to iCloud storage. Here is a sample&nbsp;archived-expanded-entitlements.xcent file:</p>
<p><script src="https://gist.github.com/Raztor0/1224bd416936ea4316e4a2708b48a1f1.js"></script></p>
<p>In this example, the only entitlement the app is requesting is for&nbsp;keychain-access-groups. You can find a complete list of the entitlements which an app may request <a href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/AddingCapabilities/AddingCapabilities.html">here</a>.</p>
<h2>META-INF/</h2>
<p>This folder contains some general metadata about the .ipa file. Under the META-INF/ folder, you will find two more files:</p>
<ul>
<li>com.apple.FixedZipMetadata.bin</li>
<li>com.apple.ZipMetadata.plist</li>
</ul>
<p>You typically don&#8217;t need to worry about this folder, and there isn&#8217;t much documentation to go with it, but let&#8217;s run through the two files found here anyway.</p>
<h3>com.apple.ZipMetadata.plist</h3>
<p>The&nbsp;<em>com.apple.ZipMetadata.plist</em> file contains some information about how the .ipa file was created, along with its uncompressed size. This is what a sample&nbsp;<em>com.apple.ZipMetadata.plist</em> file might look like:</p>
<p><script src="https://gist.github.com/Raztor0/d51544fdd45ceee5dc592afc8e01bbba.js"></script></p>
<p>Note that this .plist file is typically found in binary format, and you will need to do some work to convert it to XML format to get the output above. Converting a binary plist to an XML plist can be done with the following command:</p><pre class="crayon-plain-tag">plutil -convert xml1 com.apple.ZipMetadata.plist</pre><p></p>
<h3>com.apple.FixedZipMetadata.bin</h3>
<p>The next file,&nbsp;<em>com.apple.FixedZipMetadata.bin</em>, is binary file of some sort. There isn&#8217;t much documentation about what this is or how to read it, but doing a hexdump on it yields the following:</p><pre class="crayon-plain-tag">00000000  4d 64 46 78 01 10 00 00  00 00 00 00 00 00 00 00  |MdFx............|
00000010  00 00 00 00 00 00 00                              |.......|
00000017</pre><p></p>
<h1>That&#8217;s all folks</h1>
<p>We&#8217;ve officially gone through everything that is found within a typical App Store app file which you download and install on to your device. All of these components work together to provide you with all of the functionality you know and love, like <a href="https://itunes.apple.com/ca/app/candy-crush-saga/id553834731">lining up candy</a>, browsing&nbsp;<a href="https://itunes.apple.com/ca/app/reddit-official-trending-news/id1064216828">memes</a>, and of course, <a href="https://itunes.apple.com/us/app/color-by-number-coloring-book/id1317978215">colouring pictures of cats</a>.</p>
]]></content:encoded>
			<wfw:commentRss>https://blog.razb.me/pulling-apart-an-ios-app/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">160</post-id>	</item>
		<item>
		<title>Taylor Swift&#8217;s new app &#8220;The Swift Life™&#8221; was not written in Swift</title>
		<link>https://blog.razb.me/taylor-swifts-new-app-the-swift-life-was-not-written-in-swift/</link>
		<comments>https://blog.razb.me/taylor-swifts-new-app-the-swift-life-was-not-written-in-swift/#respond</comments>
		<pubDate>Wed, 27 Dec 2017 09:15:00 +0000</pubDate>
		<dc:creator><![CDATA[Raz]]></dc:creator>
				<category><![CDATA[iOS]]></category>
		<category><![CDATA[Swift]]></category>

		<guid isPermaLink="false">https://blog.razb.me/?p=135</guid>
		<description><![CDATA[Late December 2017, Taylor Swift&#8217;s new iOS app called&#160;&#8220;The Swift Life™&#8221; hit the app store. The app is geared towards social media, allowing you to post content and interact with other people&#8217;s content in much the same way as Facebook, Instagram, and all the typical social media platforms we&#8217;re all<a class="moretag" href="https://blog.razb.me/taylor-swifts-new-app-the-swift-life-was-not-written-in-swift/"> Read more&#8230;</a>]]></description>
				<content:encoded><![CDATA[<p>Late December 2017, <a href="https://itunes.apple.com/nz/app/the-swift-life/id1205727849">Taylor Swift&#8217;s new iOS app</a> called&nbsp;&#8220;<span><strong>The Swift Life<img src="https://s.w.org/images/core/emoji/11/72x72/2122.png" alt="™" class="wp-smiley" style="height: 1em; max-height: 1em;" /></strong>&#8221; <a href="https://techcrunch.com/2017/12/14/taylor-swifts-new-app-the-swift-life-is-out-now/">hit the app store</a>.</span></p>
<p>The app is geared towards social media, allowing you to post content and interact with other people&#8217;s content in much the same way as Facebook, Instagram, and all the typical social media platforms we&#8217;re all familiar with. However, the one thing that seems to set her app apart is the fact that when a post by a fan gets popular enough, there&#8217;s a chance that Taylor Swift herself will see it, and even possibly reply. Cool stuff.</p>
<p>Aside from that, the app is jam-packed with Taylor Swift-ness; from exclusive pictures and videos posted by the Swift goddess herself, to animated Taylor-themed emoji (which they&#8217;ve creatively dubbed Taymoji<span><img src="https://s.w.org/images/core/emoji/11/72x72/2122.png" alt="™" class="wp-smiley" style="height: 1em; max-height: 1em;" />), to&nbsp;</span>having Taylor&#8217;s songs with lyrics constantly playing at the top of the app. Even the error messages make use of lyrics from Taylor&#8217;s songs.</p>
<p><div id="attachment_136" style="width: 200px" class="wp-caption alignright"><img data-attachment-id="136" data-permalink="https://blog.razb.me/taylor-swifts-new-app-the-swift-life-was-not-written-in-swift/img_0803/" data-orig-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/IMG_0803.png?fit=1125%2C2436&amp;ssl=1" data-orig-size="1125,2436" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="IMG_0803" data-image-description="&lt;p&gt;Error message using song lyrics&lt;/p&gt;
" data-medium-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/IMG_0803.png?fit=139%2C300&amp;ssl=1" data-large-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/IMG_0803.png?fit=473%2C1024&amp;ssl=1" src="https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/IMG_0803.png?resize=190%2C412&#038;ssl=1" alt="Error message using song lyrics" width="190" height="412" class=" wp-image-136" srcset="https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/IMG_0803.png?w=1125&amp;ssl=1 1125w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/IMG_0803.png?resize=139%2C300&amp;ssl=1 139w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/IMG_0803.png?resize=768%2C1663&amp;ssl=1 768w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2017/12/IMG_0803.png?resize=473%2C1024&amp;ssl=1 473w" sizes="(max-width: 190px) 100vw, 190px" data-recalc-dims="1" /><p class="wp-caption-text">&#8220;Blank Space&#8221; error message</p></div></p>
<p>Now the question is, with all of this Swiftiness packed into one app, surely it must also be written in <a href="https://swift.org/about/">Swift</a>, right? Wrong.</p>
<p>Taylor Swift&#8217;s &#8220;The Swift Life<img src="https://s.w.org/images/core/emoji/11/72x72/2122.png" alt="™" class="wp-smiley" style="height: 1em; max-height: 1em;" />&#8221; is, ironically, not written in Swift.</p>
<p><em>Some technical details:</em><br />
There are two main programming languages which are used to write iOS applications: <a href="https://en.wikipedia.org/wiki/Objective-C">Objective-C</a> and <a href="https://en.wikipedia.org/wiki/Swift_(programming_language)">Swift</a>.<br />
In order for an iOS app to support Swift code, it must include something called the <a href="https://github.com/apple/swift/blob/master/docs/Runtime.md">Swift runtime</a> which is just a collection of frameworks conveniently packaged under a folder called &#8220;Frameworks&#8221; inside of the&nbsp;<span>iOS App Store Package (.IPA) file</span>. For a more detailed look at the inner-workings of an .IPA file, check out <a href="https://blog.razb.me/pulling-apart-an-ios-app/">this post</a>. Taking a look at Taylor&#8217;s app, it does not contain the Swift runtime, and therefore it cannot contain any Swift code.</p>
<p>Quite a missed opportunity if you ask me.</p>
<p>I guess the developers just weren&#8217;t <em>ready for it</em>.</p>
]]></content:encoded>
			<wfw:commentRss>https://blog.razb.me/taylor-swifts-new-app-the-swift-life-was-not-written-in-swift/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">135</post-id>	</item>
		<item>
		<title>kSecAttrAccessGroupToken &#8211; A workaround for the keychain autodelete behaviour found in iOS 10.3 beta2</title>
		<link>https://blog.razb.me/ksecattraccessgrouptoken-a-workaround-for-the-keychain-autodelete-behaviour-found-in-ios-10-3-beta2/</link>
		<comments>https://blog.razb.me/ksecattraccessgrouptoken-a-workaround-for-the-keychain-autodelete-behaviour-found-in-ios-10-3-beta2/#respond</comments>
		<pubDate>Tue, 21 Feb 2017 19:27:12 +0000</pubDate>
		<dc:creator><![CDATA[Raz]]></dc:creator>
				<category><![CDATA[iOS]]></category>

		<guid isPermaLink="false">http://razb.me/?p=109</guid>
		<description><![CDATA[December 27, 2017 update: According to this post on the Apple Developer forums regarding the issue discussed in this topic, This is a bug in the beta that should already be fixed by the time you read this. kSecAttrAccessGroupToken is writable only by CryptoTokenKit smart card drivers. Apps can query<a class="moretag" href="https://blog.razb.me/ksecattraccessgrouptoken-a-workaround-for-the-keychain-autodelete-behaviour-found-in-ios-10-3-beta2/"> Read more&#8230;</a>]]></description>
				<content:encoded><![CDATA[<p><strong>December 27, 2017 update:</strong></p>
<p>According to <a href="https://forums.developer.apple.com/thread/72271#224455">this post on the Apple Developer forums</a> regarding the issue discussed in this topic,</p>
<blockquote><p><span>This is a bug in the beta that should already be fixed by the time you read this.</span></p>
<p><span>kSecAttrAccessGroupToken is writable only by CryptoTokenKit smart card drivers. Apps can query the keychain using that attribute in order to find items stored on a particular smart card. This attribute is not for any other use.</span></p></blockquote>
<p>It appears as though the <em><span>kSecAttrAccessGroupToken</span></em> access group was never meant to be writable by any app outside of <em>CryptoTokenKit</em>. This means that normal apps like yours and mine cannot make use of this access group for the purpose of writing our own custom data to it.</p>
<p>It&#8217;s also worth noting that the keychain autodelete behaviour which was observed in the iOS 10.3 beta did not end up making it into the public releases. So, for the time being, our beloved keychain continues to persist data beyond app deletion.</p>
<p><strong>Original post below:</strong></p>
<p>On February 7th, 2017, Apple released iOS 10.3 Beta2 to the public, and with that came some changes to the keychain.</p>
<p>The keychain was introduced to iOS devices with the release of iOS 7. The intention of the keychain is to allow a user to securely store login credentials to any number of services so as to not have to type them in every time. Safari uses the iOS keychain and prompts users to save their credentials whenever they login to any websites. However, the keychain is also available to developers. This means that it is possible to store passwords, certificates, and keys without any user interaction.</p>
<p>One of the (<a href="https://forums.developer.apple.com/message/112523#112523">potentially unintended</a>) side-effects of the keychain is that anything stored inside of it would persist even after uninstalling the app. This means that anything an app stores in the keychain would potentially live beyond the app itself, and the next time the app is installed and launched, it could read from the keychain and continue as if nothing ever happened.</p>
<p>This property of the keychain is quite useful and heavily relied upon by developers, however, it seems as though this might change with iOS 10.3. As outlined in<a href="https://forums.developer.apple.com/message/210559"> this post</a> on the Apple developer forums, keychain items are now automatically deleted when the app is deleted. For the purpose of keychain access groups, the keychain items are deleted when the last app in that access group is deleted.</p>
<p>This can be problematic for many apps which rely on the persistence of the keychain in order for their features to work. This was certainly true for me, so I decided to go looking for a workaround.</p>
<p>That is when I stumbled upon the constant <em>kSecAttrAccessGroupToken</em>, of which there does not seem to be much information about on the Internet. Here is the documentation found with this constant:</p><pre class="crayon-plain-tag">/*!
     @enum kSecAttrAccessGroup Value Constants
     @constant kSecAttrAccessGroupToken Represents well-known access group
         which contains items provided by external token (typically smart card).
         This may be used as a value for kSecAttrAccessGroup attribute. Every
         application has access to this access group so it is not needed to
         explicitly list it in keychain-access-groups entitlement, but application
         must explicitly state this access group in keychain queries in order to
         be able to access items from external tokens.
*/
extern const CFStringRef kSecAttrAccessGroupToken
    __OSX_AVAILABLE_STARTING(__MAC_10_12, __IPHONE_10_0);</pre><p>So, it would seem as though there is an access group, introduced with iOS 10, which all apps on the phone have read/write access to. If this is the case, then anything stored within that access group should persist forever, since any app currently installed may want to read from it in the future.</p>
<p>After testing my hypothesis, this indeed seems to be the case. Saving keychain items with the <em>kSecAttrAccessGroupToken</em> access group persists beyond app deletion. I wrote some sample code demonstrating this <a href="https://gist.github.com/Raztor0/34ad0e23a410c33526c9fa1b6e8d281c">here</a>.</p>
<p>So, in order to preserve existing keychain functionality and have entries persist beyond app deletion, a simple work around could be to use this access group. However, there is a caveat:</p>
<p>Since any app on the system can freely read and write to this access group, it is important to consider any security side effects this might have for your app. If you are storing sensitive information in the keychain, it could be worth encrypting keychain entries yourself before saving it off to the keychain.</p>
]]></content:encoded>
			<wfw:commentRss>https://blog.razb.me/ksecattraccessgrouptoken-a-workaround-for-the-keychain-autodelete-behaviour-found-in-ios-10-3-beta2/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">109</post-id>	</item>
		<item>
		<title>Debugging HTTP requests using Charles</title>
		<link>https://blog.razb.me/debugging-http-requests-using-charles/</link>
		<comments>https://blog.razb.me/debugging-http-requests-using-charles/#respond</comments>
		<pubDate>Tue, 05 Apr 2016 05:24:21 +0000</pubDate>
		<dc:creator><![CDATA[Raz]]></dc:creator>
				<category><![CDATA[Networking]]></category>

		<guid isPermaLink="false">http://razb.me/?p=87</guid>
		<description><![CDATA[Every once in a while it becomes useful to be able to actually look at the network request that is leaving your device to understand why things aren&#8217;t working, or to gain insight into how other people&#8217;s things work. While tools for network debugging such as Wireshark&#160;are great and have<a class="moretag" href="https://blog.razb.me/debugging-http-requests-using-charles/"> Read more&#8230;</a>]]></description>
				<content:encoded><![CDATA[<p>Every once in a while it becomes useful to be able to actually look at the network request that is leaving your device to understand why things aren&#8217;t working, or to gain insight into how other people&#8217;s things work. While tools for network debugging such as <a href="https://www.wireshark.org/" target="_blank" rel="noopener">Wireshark</a>&nbsp;are great and have existed since forever,&nbsp;<a href="http://www.charlesproxy.com/" target="_blank" rel="noopener">Charles</a> web debugging proxy was built specifically to make http requests very easy to debug.</p>
<p>How it works:</p>
<p>You &#8212;&gt; Charles &#8212;&gt; Internet</p>
<p>By sitting in between you and the Internet, Charles is able to pick up on every single network request that you send and receive. Once it picks up on some http requests, it shows you everything you need to know about it such as the headers in the request and the body of the response. It looks something like this:</p>
<p><img data-attachment-id="91" data-permalink="https://blog.razb.me/debugging-http-requests-using-charles/screen-shot-2016-04-04-at-10-23-26-pm/" data-orig-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.23.26-PM.png?fit=2548%2C1410&amp;ssl=1" data-orig-size="2548,1410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Screen Shot 2016-04-04 at 10.23.26 PM" data-image-description="" data-medium-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.23.26-PM.png?fit=300%2C166&amp;ssl=1" data-large-file="https://i1.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.23.26-PM.png?fit=750%2C415&amp;ssl=1" class="alignnone size-full wp-image-91" src="https://i0.wp.com/razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.23.26-PM.png?resize=750%2C415" alt="Screen Shot 2016-04-04 at 10.23.26 PM" width="750" height="415" srcset="https://i1.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.23.26-PM.png?w=2548&amp;ssl=1 2548w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.23.26-PM.png?resize=300%2C166&amp;ssl=1 300w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.23.26-PM.png?resize=768%2C425&amp;ssl=1 768w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.23.26-PM.png?resize=1024%2C567&amp;ssl=1 1024w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.23.26-PM.png?resize=1200%2C664&amp;ssl=1 1200w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.23.26-PM.png?w=1500&amp;ssl=1 1500w, https://i1.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.23.26-PM.png?w=2250&amp;ssl=1 2250w" sizes="(max-width: 750px) 100vw, 750px" data-recalc-dims="1" /></p>
<p><img data-attachment-id="89" data-permalink="https://blog.razb.me/debugging-http-requests-using-charles/screen-shot-2016-04-04-at-10-18-42-pm/" data-orig-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.42-PM.png?fit=1576%2C410&amp;ssl=1" data-orig-size="1576,410" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Screen Shot 2016-04-04 at 10.18.42 PM" data-image-description="" data-medium-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.42-PM.png?fit=300%2C78&amp;ssl=1" data-large-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.42-PM.png?fit=750%2C195&amp;ssl=1" class="size-full wp-image-89 aligncenter" src="https://i1.wp.com/razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.42-PM.png?resize=750%2C195" alt="Screen Shot 2016-04-04 at 10.18.42 PM" width="750" height="195" srcset="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.42-PM.png?w=1576&amp;ssl=1 1576w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.42-PM.png?resize=300%2C78&amp;ssl=1 300w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.42-PM.png?resize=768%2C200&amp;ssl=1 768w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.42-PM.png?resize=1024%2C266&amp;ssl=1 1024w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.42-PM.png?resize=1200%2C312&amp;ssl=1 1200w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.42-PM.png?w=1500&amp;ssl=1 1500w" sizes="(max-width: 750px) 100vw, 750px" data-recalc-dims="1" /></p>
<p><img data-attachment-id="90" data-permalink="https://blog.razb.me/debugging-http-requests-using-charles/screen-shot-2016-04-04-at-10-18-45-pm/" data-orig-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.45-PM.png?fit=1638%2C1124&amp;ssl=1" data-orig-size="1638,1124" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Screen Shot 2016-04-04 at 10.18.45 PM" data-image-description="" data-medium-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.45-PM.png?fit=300%2C206&amp;ssl=1" data-large-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.45-PM.png?fit=750%2C515&amp;ssl=1" class="alignnone size-full wp-image-90" src="https://i1.wp.com/razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.45-PM.png?resize=750%2C515" alt="Screen Shot 2016-04-04 at 10.18.45 PM" width="750" height="515" srcset="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.45-PM.png?w=1638&amp;ssl=1 1638w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.45-PM.png?resize=300%2C206&amp;ssl=1 300w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.45-PM.png?resize=768%2C527&amp;ssl=1 768w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.45-PM.png?resize=1024%2C703&amp;ssl=1 1024w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.45-PM.png?resize=1200%2C823&amp;ssl=1 1200w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.18.45-PM.png?w=1500&amp;ssl=1 1500w" sizes="(max-width: 750px) 100vw, 750px" data-recalc-dims="1" /></p>
<p>This works great for http or unencrypted content, but what about https? Luckily there&#8217;s ways around that as well. Without going into the details, by installing a certificate on the device you want to debug, Charles can provide the same functionality for encrypted connections as well. Let&#8217;s use the Shopkick app as an example.</p>
<p><img data-attachment-id="94" data-permalink="https://blog.razb.me/debugging-http-requests-using-charles/screen-shot-2016-04-04-at-10-31-00-pm/" data-orig-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.00-PM.png?fit=1602%2C358&amp;ssl=1" data-orig-size="1602,358" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Screen Shot 2016-04-04 at 10.31.00 PM" data-image-description="" data-medium-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.00-PM.png?fit=300%2C67&amp;ssl=1" data-large-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.00-PM.png?fit=750%2C168&amp;ssl=1" class="size-full wp-image-94 aligncenter" src="https://i2.wp.com/razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.00-PM.png?resize=750%2C168" alt="Screen Shot 2016-04-04 at 10.31.00 PM" width="750" height="168" srcset="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.00-PM.png?w=1602&amp;ssl=1 1602w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.00-PM.png?resize=300%2C67&amp;ssl=1 300w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.00-PM.png?resize=768%2C172&amp;ssl=1 768w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.00-PM.png?resize=1024%2C229&amp;ssl=1 1024w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.00-PM.png?resize=1200%2C268&amp;ssl=1 1200w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.00-PM.png?w=1500&amp;ssl=1 1500w" sizes="(max-width: 750px) 100vw, 750px" data-recalc-dims="1" /></p>
<p>Trying to analyze the calls to https://app.shopkick.com doesn&#8217;t show any useful information because they&#8217;re encrypted over SSL. Let&#8217;s enable SSL Proxying.</p>
<p><img data-attachment-id="95" data-permalink="https://blog.razb.me/debugging-http-requests-using-charles/screen-shot-2016-04-04-at-10-31-08-pm/" data-orig-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.08-PM.png?fit=486%2C334&amp;ssl=1" data-orig-size="486,334" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Screen Shot 2016-04-04 at 10.31.08 PM" data-image-description="" data-medium-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.08-PM.png?fit=300%2C206&amp;ssl=1" data-large-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.08-PM.png?fit=486%2C334&amp;ssl=1" class="size-full wp-image-95 aligncenter" src="https://i1.wp.com/razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.08-PM.png?resize=486%2C334" alt="Screen Shot 2016-04-04 at 10.31.08 PM" width="486" height="334" srcset="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.08-PM.png?w=486&amp;ssl=1 486w, https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.08-PM.png?resize=300%2C206&amp;ssl=1 300w" sizes="(max-width: 486px) 100vw, 486px" data-recalc-dims="1" /></p>
<p><img data-attachment-id="96" data-permalink="https://blog.razb.me/debugging-http-requests-using-charles/screen-shot-2016-04-04-at-10-31-29-pm/" data-orig-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.29-PM.png?fit=2498%2C1240&amp;ssl=1" data-orig-size="2498,1240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Screen Shot 2016-04-04 at 10.31.29 PM" data-image-description="" data-medium-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.29-PM.png?fit=300%2C149&amp;ssl=1" data-large-file="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.29-PM.png?fit=750%2C372&amp;ssl=1" class="alignnone size-full wp-image-96" src="https://i2.wp.com/razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.29-PM.png?resize=750%2C372" alt="Screen Shot 2016-04-04 at 10.31.29 PM" width="750" height="372" srcset="https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.29-PM.png?w=2498&amp;ssl=1 2498w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.29-PM.png?resize=300%2C149&amp;ssl=1 300w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.29-PM.png?resize=768%2C381&amp;ssl=1 768w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.29-PM.png?resize=1024%2C508&amp;ssl=1 1024w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.29-PM.png?resize=1200%2C596&amp;ssl=1 1200w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.29-PM.png?w=1500&amp;ssl=1 1500w, https://i0.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.29-PM.png?w=2250&amp;ssl=1 2250w" sizes="(max-width: 750px) 100vw, 750px" data-recalc-dims="1" /><img data-attachment-id="97" data-permalink="https://blog.razb.me/debugging-http-requests-using-charles/screen-shot-2016-04-04-at-10-31-36-pm/" data-orig-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.36-PM.png?fit=1730%2C1238&amp;ssl=1" data-orig-size="1730,1238" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Screen Shot 2016-04-04 at 10.31.36 PM" data-image-description="" data-medium-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.36-PM.png?fit=300%2C215&amp;ssl=1" data-large-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.36-PM.png?fit=750%2C537&amp;ssl=1" class="alignnone size-full wp-image-97" src="https://i2.wp.com/razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.36-PM.png?resize=750%2C537" alt="Screen Shot 2016-04-04 at 10.31.36 PM" width="750" height="537" srcset="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.36-PM.png?w=1730&amp;ssl=1 1730w, https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.36-PM.png?resize=300%2C215&amp;ssl=1 300w, https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.36-PM.png?resize=768%2C550&amp;ssl=1 768w, https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.36-PM.png?resize=1024%2C733&amp;ssl=1 1024w, https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.36-PM.png?resize=1200%2C859&amp;ssl=1 1200w, https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.31.36-PM.png?w=1500&amp;ssl=1 1500w" sizes="(max-width: 750px) 100vw, 750px" data-recalc-dims="1" /></p>
<p>And now we can see all that traffic in the clear.</p>
<p>Charles also allows us to copy the cURL command for a particular request. Let&#8217;s use this to simulate a login from the command line.</p>
<p><img data-attachment-id="99" data-permalink="https://blog.razb.me/debugging-http-requests-using-charles/screen-shot-2016-04-04-at-10-39-52-pm/" data-orig-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.39.52-PM.png?fit=474%2C292&amp;ssl=1" data-orig-size="474,292" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Screen Shot 2016-04-04 at 10.39.52 PM" data-image-description="" data-medium-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.39.52-PM.png?fit=300%2C185&amp;ssl=1" data-large-file="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.39.52-PM.png?fit=474%2C292&amp;ssl=1" class="size-full wp-image-99 aligncenter" src="https://i0.wp.com/razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.39.52-PM.png?resize=474%2C292" alt="Screen Shot 2016-04-04 at 10.39.52 PM" width="474" height="292" srcset="https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.39.52-PM.png?w=474&amp;ssl=1 474w, https://i2.wp.com/blog.razb.me/wp-content/uploads/2016/04/Screen-Shot-2016-04-04-at-10.39.52-PM.png?resize=300%2C185&amp;ssl=1 300w" sizes="(max-width: 474px) 100vw, 474px" data-recalc-dims="1" /></p><pre class="crayon-plain-tag">razvanbangu@Razvans-MacBook-Pro Fraudkick (master) $ curl -H "Host: app.shopkick.com" -H "X-Sts: 1459834233364" -H "X-Screen: 320,480" -H "X-App: shopkick/4.8.5" -H "X-Device: Apple/Unknown: iPhone4,1" -H "X-Device-Id: enhjbisq9flt3g37hegoctwf1s7gvkhtxks2lzry" -H "X-Sys: iPhone OS/9.0" -H "Proxy-Connection: keep-alive" -H "X-Client-Capabilities: 2" -H "Accept: */*" -H "Accept-Language: en-ca" -H "User-Agent: shopkick/1177 CFNetwork/758.0.2 Darwin/15.0.0" -H "X-Adv-Id: CD5B8AAC-32D4-4988-B217-349F3EDB6887" -H "X-Mac: 3DjMFoLY3Alb1HT-_aizd7FTyBU=" -H "X-API-Key: 0e8450ff-351e-406d-a365-03f735f87d9f" -H "Cookie: app_version=4.8.5; device=Apple/Unknown%3A%20iPhone4%2C1; device_id=enhjbisq9flt3g37hegoctwf1s7gvkhtxks2lzry; device_os=iPhone%20OS/9.0; device_type=Apple/Unknown%3A%20iPhone4%2C1" --data "password=&lt;notmypassword&gt;&amp;device_id=enhjbisq9flt3g37hegoctwf1s7gvkhtxks2lzry&amp;email=raz10%40razb.me&amp;device_model=Unknown%3A+iPhone4%2C1&amp;kcid=6Xl4mn7rEpgHUfmrIwdE203H3iKarm6Gf4%2FVaGH2LyU%3D-6Xl4mn7rEpgHUfmrIwdE203H3iKarm6Gf4%2FVaGH2LyU%3D-6Xl4mn7rEpgHUfmrIwdE203H3iKarm6Gf4%2FVaGH2LyU%3D" --compressed https://app.shopkick.com/shopkick/v1/user/login
{"status": 0, "user_id": 16836985655, "user_info": {"first_name": "razzle", "is_google_plus_connected": false, "is_facebook_connected": false, "country": 1, "created_ts_utc": 1459823387000, "is_registered": true, "enrolled_loyalty_program_ids": [], "email": "raz10@razb.me", "is_buy_and_collect_enrolled": false}, "client_app_ui_flags": {"aggregate_deals_enabled": true, "tab_navigation_enabled": true, "preselect_all_recommended_friends": false, "allowed_invite_media": "1,2,3", "show_kicks_center": true, "use_combined_store_and_deals_tab": false, "max_number_invalid_email_logs": 3, "saving_deals_enabled": true, "default_tab_context_override": "store", "show_new_card_linking_screen": false, "tab_context_order_override": ["store", "deals", "browse"], "number_of_recommendations": 10}, "session_key_base64_enc": "JRtCoHkdBjx6lA7xU+oUa3mgDmoltqNaj6YYvNPSNgbmYR6T49gzHEx6WWIkXUzoRcKgCP/FMmmmvLxtFZYfRg==", "common": {"popups_response": {"force_display": true, "popups": [{"type": 6, "layered_popup_details": {"text_views": [{"text": "Thanks for all your shopkick love - you've logged in on an additional device. Just remember that you can only do walk-ins and scans with one device at a time and can't share devices with your friends.", "frame": {"y": 155, "x": 20, "height": 200, "width": 280}, "style": {"color": "FFFFFF", "font_size": 14, "font_name": "HelveticaNeue"}, "android_style": {"color": "FFFFFF", "font_size": 14, "font_face": "Roboto"}}, {"text": "Did you know?", "frame": {"y": 80, "x": 0, "height": 100, "width": 320}, "style": {"color": "FFFFFF", "font_size": 40, "font_name": "HelveticaNeue-Light"}, "android_style": {"color": "FFFFFF", "font_size": 40, "font_face": "Roboto"}}], "buttons": [{"action": {"type": 1}, "image_view_info": {"frame": {"y": 0, "x": 0, "height": 460, "width": 320}, "image_url": "https://app2.shopkick.com/shopkick/images/generic_buttons/transparent_dismiss.png#2x&amp;1_5x"}}], "image_views": [{"frame": {"y": 0, "x": 0, "height": 50, "width": 50}, "image_url": "https://app2.shopkick.com/shopkick/images/generic_buttons/close_button.png#2x&amp;1_5x"}]}}]}, "request_id": "ChPAjAAAz1wABS+2TB5dSA"}}</pre><p>Charles is great for debugging mobile apps which mostly only make use of http connections, however in order for this to work on a mobile device we need to configure the device to use our computer as a proxy. On iOS you can do this by going to the wifi settings and scrolling down to the HTTP Proxy section. Fill in the details to match your computer where Charles is running.</p>
<p><img class="aligncenter" src="https://i0.wp.com/nvisium.com/blog/2014/08/06/ios-assessments-with-burp-ifunbox-sqlite/image2.jpg?resize=324%2C483&#038;ssl=1" alt="" width="324" height="483"  data-recalc-dims="1"></p>
<p>Once that is done, open safari and navigate to http://charlesproxy.com/getssl That will prompt you to install the Charles certificate and allow you to debug&nbsp;SSL connections coming from your device.</p>
<p>Happy debugging!</p>
]]></content:encoded>
			<wfw:commentRss>https://blog.razb.me/debugging-http-requests-using-charles/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">87</post-id>	</item>
		<item>
		<title>[LLDB/Xcode] Manipulating the currently executing line</title>
		<link>https://blog.razb.me/manipulating-the-currently-executing-line/</link>
		<comments>https://blog.razb.me/manipulating-the-currently-executing-line/#respond</comments>
		<pubDate>Fri, 25 Mar 2016 05:17:38 +0000</pubDate>
		<dc:creator><![CDATA[Raz]]></dc:creator>
				<category><![CDATA[LLDB]]></category>
		<category><![CDATA[Objective-C]]></category>

		<guid isPermaLink="false">http://razb.me/?p=68</guid>
		<description><![CDATA[Have you ever wanted to quickly see the result of a particular code path, but realized you had to stop the app, comment out or modify some code, and run the app again so that the new code follows a different path? There may be a quicker way to achieve<a class="moretag" href="https://blog.razb.me/manipulating-the-currently-executing-line/"> Read more&#8230;</a>]]></description>
				<content:encoded><![CDATA[<p>Have you ever wanted to quickly see the result of a particular code path, but realized you had to stop the app, comment out or modify some code, and run the app again so that the new code follows a different path? There may be a quicker way to achieve this. Consider the following example:</p>
<p><img class="aligncenter" src="http://i0.wp.com/razb.me/wp-content/uploads/2016/03/Screen-Shot-2016-03-24-at-9.51.46-PM.png?w=648" alt="" /></p>
<p>The result is YES under normal circumstances, but we want to test what happens if the result was ever NO.</p>
<p>One way to do that is by dragging the little green arrow next to the breakpoint marker down into the else statement so that it looks like this:</p>
<p><img class="aligncenter" src="https://i1.wp.com/razb.me/wp-content/uploads/2016/03/Screen-Shot-2016-03-24-at-10.12.06-PM.png?w=750" alt="" data-recalc-dims="1" /></p>
<p>The result is YES, but we have managed to get ourselves into the else condition to test what happens going down that code path.</p>
<p>Upon dragging the green arrow, Xcode will display the following error:</p>
<p><img class="aligncenter" src="https://i0.wp.com/razb.me/wp-content/uploads/2016/03/Screen-Shot-2016-03-24-at-9.52.18-PM.png?w=750" alt="" data-recalc-dims="1" /></p>
<p>Take a second to read the error and understand it. Then, press &#8216;Move&#8217; to move the instruction pointer. Now, simply resume execution of the program. Voila, you have just tested your alternative code path without stopping, commenting out or modifying the code, and restarting the app.</p>
]]></content:encoded>
			<wfw:commentRss>https://blog.razb.me/manipulating-the-currently-executing-line/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">68</post-id>	</item>
		<item>
		<title>Around the world in 15 seconds</title>
		<link>https://blog.razb.me/around-the-world-in-15-seconds/</link>
		<comments>https://blog.razb.me/around-the-world-in-15-seconds/#comments</comments>
		<pubDate>Sat, 19 Mar 2016 19:21:31 +0000</pubDate>
		<dc:creator><![CDATA[Raz]]></dc:creator>
				<category><![CDATA[Networking]]></category>
		<category><![CDATA[15s]]></category>
		<category><![CDATA[around]]></category>
		<category><![CDATA[circumnavigating]]></category>
		<category><![CDATA[forwarding]]></category>
		<category><![CDATA[in]]></category>
		<category><![CDATA[port]]></category>
		<category><![CDATA[ssh]]></category>
		<category><![CDATA[the]]></category>
		<category><![CDATA[world]]></category>

		<guid isPermaLink="false">http://razb.me/?p=48</guid>
		<description><![CDATA[The first aerial circumnavigation of the world was performed in 1924 by the United States Army Air Service. The trip took 175 days and covered over 27,000 miles. Today, we are going to circumnavigate the world in&#160;under 15&#160;seconds. In order to achieve this, what we are going to do is<a class="moretag" href="https://blog.razb.me/around-the-world-in-15-seconds/"> Read more&#8230;</a>]]></description>
				<content:encoded><![CDATA[<p>The <a href="https://en.wikipedia.org/wiki/First_aerial_circumnavigation" target="_blank" rel="noopener">first aerial circumnavigation</a> of the world was performed in 1924 by the United States Army Air Service. The trip took 175 days and covered over 27,000 miles. Today, we are going to circumnavigate the world in&nbsp;under 15&nbsp;seconds.</p>
<p>In order to achieve this, what we are going to do is link together a chain of computers starting with yours, going all the way around the world, and ending right back where it started; with yours. After setting that up, we will be sending a picture of yourself from yourself to yourself, and in the process circumnavigating the world.</p>
<p>Before we begin, I will be using <a href="https://www.digitalocean.com/" target="_blank" rel="noopener">DigitalOcean</a>&nbsp;to spin up our servers. If you want to follow along at home, DigitalOcean offers new users a promo code to get you up and running for free. Use:&nbsp;<strong>DONEWS&nbsp;</strong>or you can use my personal promo url:&nbsp;<strong><a href="https://m.do.co/c/74fd80a9022a" target="_blank" rel="noopener">m.do.co/c/74fd80a9022a</a>&nbsp;</strong>the choice is yours.</p>
<p>After creating an account with DigitalOcean, you will want to set up an SSH key for use with your servers. DigitalOcean has a great <a href="https://www.digitalocean.com/community/tutorials/how-to-use-ssh-keys-with-digitalocean-droplets" target="_blank" rel="noopener">tutorial on how to set that up</a> which you should follow and complete before reading further.</p>
<p>Now, we will spin up 6 servers, one in each of the following data centres: San Fransisco, New York, London, Amsterdam, Frankfurt, and Singapore. Upon creating each server, select Ubuntu 14.04.4, the $5/month option, and add your SSH key.</p>
<blockquote><p>NOTE: All commands in this tutorial are assumed to be executed by the root user.</p></blockquote>
<p>Once all of your servers are up and running, SSH into every one of them and set a root password. For the sake of simplicity, we will be communicating between our servers via SSH root@host. You probably do not want to do this in practise.</p>
<p>Before we go any further, it may be worth confirming that a request from Singapore-&gt;San Fransisco does indeed go across the Pacific Ocean to complete the loop around the world. In order to do that, SSH into your Singapore machine and type in the following command:</p><pre class="crayon-plain-tag">$ traceroute &lt;San Fransisco IP Address&gt; -T</pre><p>Replacing <strong>&lt;San Fransisco IP Address&gt;</strong> with the actual address of your San Fransisco server.</p>
<p>If all goes well, you should see output similar to this:</p><pre class="crayon-plain-tag">root@AroundTheWorldSingapore:~# traceroute 192.241.221.191 -T
traceroute to 192.241.221.191 (192.241.221.191), 30 hops max, 60 byte packets
 1  128.199.191.253 (128.199.191.253)  0.477 ms 128.199.191.254 (128.199.191.254)  0.474 ms  0.452 ms
 2  103.253.144.233 (103.253.144.233)  0.440 ms 103.253.144.229 (103.253.144.229)  0.449 ms  0.429 ms
 3  116.51.27.189 (116.51.27.189)  1.371 ms 103.253.144.249 (103.253.144.249)  0.440 ms 116.51.27.189 (116.51.27.189)  1.596 ms
 4  ae-1.r20.sngpsi05.sg.bb.gin.ntt.net (129.250.3.146)  14.718 ms 116.51.27.189 (116.51.27.189)  1.692 ms ae-1.r20.sngpsi05.sg.bb.gin.ntt.net (129.250.3.146)  14.708 ms
 5  ae-8.r22.snjsca04.us.bb.gin.ntt.net (129.250.3.48)  167.050 ms  178.774 ms ae-1.r20.sngpsi05.sg.bb.gin.ntt.net (129.250.3.146)  14.732 ms
 6  ae-19.r01.snjsca04.us.bb.gin.ntt.net (129.250.3.27)  181.920 ms ae-8.r22.snjsca04.us.bb.gin.ntt.net (129.250.3.48)  168.298 ms  169.413 ms
 7  ae-40.r02.snjsca04.us.bb.gin.ntt.net (129.250.3.121)  175.240 ms ae-4.r05.plalca01.us.bb.gin.ntt.net (129.250.5.32)  197.201 ms ae-40.r02.snjsca04.us.bb.gin.ntt.net (129.250.3.121)  187.610 ms
 8  xe-0-4-0-17.r06.plalca01.us.ce.gin.ntt.net (129.250.203.82)  168.083 ms ae-4.r05.plalca01.us.bb.gin.ntt.net (129.250.5.32)  182.682 ms xe-0-0-0-23.r05.plalca01.us.ce.gin.ntt.net (129.250.204.118)  181.313 ms
 9  xe-0-0-0-23.r05.plalca01.us.ce.gin.ntt.net (129.250.204.118)  186.122 ms 198.199.99.238 (198.199.99.238)  184.223 ms xe-0-4-0-17.r06.plalca01.us.ce.gin.ntt.net (129.250.203.82)  178.457 ms
10  192.241.221.191 (192.241.221.191)  186.219 ms  176.327 ms  172.506 ms</pre><p>Taking a look at lines 4 and 5, we can see that our packet went from sg.bb.gin.ntt.net to us.bb.gin.ntt.net and the time across those two nodes spiked from 14.718ms to 167.050ms. This is pretty promising that our packets do in fact cross the ocean. Now we can continue with linking our servers together.</p>
<p>In order to move data from one server to another, we&#8217;re going to use <a href="https://help.ubuntu.com/community/SSH/OpenSSH/PortForwarding#Port_Forwarding_Explained" target="_blank" rel="noopener">SSH&nbsp;port forwarding</a>. In this tutorial I will explain how to do this for the first and last server, and the process for the ones in the middle is pretty much identical.</p>
<p>SSH into all of your servers, modify /etc/ssh/sshd_config, and add the following line to the file:</p><pre class="crayon-plain-tag">GatewayPorts clientspecified</pre><p>After saving, restart ssh:</p><pre class="crayon-plain-tag">$ service ssh restart</pre><p>This allows us to specify which interface the next machine in the chain should listen on.</p>
<p>Now, from your San Fransisco server, execute the following command:</p><pre class="crayon-plain-tag">$ screen ssh -L &lt;San Fransisco IP Address&gt;:4455:&lt;New York IP Address&gt;:4455&nbsp;&lt;New York IP Address&gt;</pre><p>This tells our San Fransisco server to forward all requests to its port 4455 over to our New York Server&#8217;s port 4455. Repeat this process for New York -&gt; London, London -&gt; Amsterdam, Amsterdam -&gt; Frankfurt, and lastly Frankfurt -&gt; Singapore.</p>
<blockquote><p>If you are using OSX, before going onto the last step you need to allow remote login to your mac. To do this, go to Settings -&gt; Sharing-&gt; Remote Login. Make sure it is checked.</p></blockquote>
<p class="p1"><span class="s1">For the last link in the chain, we must hook up our Singapore server to our local computer. From your personal computer, execute the following command:</span></p>
<p></p><pre class="crayon-plain-tag">$ screen ssh -R &lt;Singapore IP Address&gt;:4455:localhost:22&nbsp;&lt;Singapore IP Address&gt;</pre><p></p>
<p class="p1"><span class="s1">At this point, you now have a complete chain of computers starting from San Fransisco, around the world to Singapore, and finally crossing the Pacific Ocean and back to your personal computer.</span></p>
<p class="p1">Now, it is time to actually send a picture of yourself around the world.</p>
<p class="p1">Navigate to the directory of the picture you want to send, and execute the following command:</p>
<p></p><pre class="crayon-plain-tag">$ scp -P 4455 &lt;picture&gt; root@&lt;San Fransisco IP Address&gt;:/</pre><p></p>
<p class="p1">This command is normally used to copy the file &lt;picture&gt; from your local machine to the / directory of the San Fransisco server. However, since we are specifying -P 4455, which the San Fransisco server is forwarding to New York, the copy file command gets forwarded to the New York server instead. And since the New York server is forwarding port 4455, the chain goes on all the way up to Singapore which is configured to forward its port 4455 to your local personal computer&#8217;s port 22.</p>
<p class="p1">Your beautiful picture travelled from your computer to San Fransisco, New York, London, Amsterdam, Frankfurt, Singapore, and back to your computer.</p>
<p class="p1">Congratulations! You have officially gone around the world!</p>
<p class="p1">A quick time profile gives us the following results:</p>
<p></p><pre class="crayon-plain-tag">root@Razvans-MacBook-Pro Desktop $ time scp -P 4455 selfie.JPG root@192.241.221.191:/
selfie.JPG                       100%   19KB  19.4KB/s   00:00    

real	0m12.866s
user	0m0.019s
sys	0m0.009s</pre><p>Alas in just 12.866 seconds you have travelled over 20,000 miles. You deserve a break.</p>
<p class="p1">
]]></content:encoded>
			<wfw:commentRss>https://blog.razb.me/around-the-world-in-15-seconds/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">48</post-id>	</item>
		<item>
		<title>Minecraft behind a firewall</title>
		<link>https://blog.razb.me/networking-minecraft-on-an-inaccessible-server/</link>
		<comments>https://blog.razb.me/networking-minecraft-on-an-inaccessible-server/#respond</comments>
		<pubDate>Wed, 16 Mar 2016 06:02:28 +0000</pubDate>
		<dc:creator><![CDATA[Raz]]></dc:creator>
				<category><![CDATA[Networking]]></category>
		<category><![CDATA[linux]]></category>
		<category><![CDATA[minecraft]]></category>
		<category><![CDATA[networking]]></category>
		<category><![CDATA[private]]></category>
		<category><![CDATA[reverse]]></category>
		<category><![CDATA[servers]]></category>
		<category><![CDATA[ssh]]></category>
		<category><![CDATA[tunnel]]></category>
		<category><![CDATA[virtual]]></category>
		<category><![CDATA[vps]]></category>

		<guid isPermaLink="false">http://razb.me/?p=28</guid>
		<description><![CDATA[Several months ago I was given access to a free, moderately powerful virtual private server (VPS) with the catch that the server sat behind a firewall which denied all incoming connections. The company hosting the VPS provided a web interface for accessing the server via a VNC connection which they<a class="moretag" href="https://blog.razb.me/networking-minecraft-on-an-inaccessible-server/"> Read more&#8230;</a>]]></description>
				<content:encoded><![CDATA[<p>Several months ago I was given access to a free, moderately powerful virtual private server (VPS) with the catch that the server sat behind a firewall which denied all incoming connections. The company hosting the VPS provided a web interface for accessing the server via a VNC connection which they routed internally. This was the only way to interact with the server.</p>
<p>Upon getting access to the VPS I immediately tried the first thing anyone would try, and that of course was running a Minecraft server on it. I was very excited about the possibility of hosting a completely free Minecraft server for my friends and I to enjoy, until I realized that it was impossible to connect to the server from the Internet.</p>
<p>So, I gave up and ran my Minecraft server on AWS instead. Thanks for reading.</p>
<p>Just kidding. I came across SSH reverse tunnels instead.</p>
<p>SSH is an incredibly powerful tool which is capable of doing a lot more than just being a secure shell to a remote machine. One of the additional features it has is reverse tunnelling.</p>
<p>Imagine you have two machines: MachineA, and MachineB.<br />
MachineA can create outgoing connections, but can not accept incoming connections.<br />
MachineB accepts both incoming and outgoing connections.</p>
<p>MachineA establishes an SSH connection to MachineB, and configures MachineB to forward all requests to port 8080 over to MachineA&#8217;s port 2020 (using the same SSH connection).</p>
<p>It looks something like this:</p>
<p>MachineB &lt;&#8212;SSH&#8212;- MachineA // Establish the connection MachineB:8080 &#8212;SSH&#8212;&gt; MachineA:2020 // Port forwarding over the established connection</p>
<p>This works fine because MachineA is not relying on any incoming connections made directly to it, but rather is able to accept incoming connections which arrive at MachineB. Now all I needed was another server which is not behind a firewall to act as MachineB.</p>
<p>Fortunately I have several small, inexpensive servers which were perfect for the job.</p>
<p>Using this functionality of SSH, I was able to piggy back one of my weaker servers to act as a proxy for the stronger server which was running Minecraft. My friends would connect to my weak server port 8080, and get forwarded over the SSH tunnel to the Minecraft server sitting behind a firewall on port 2020.</p>
<p>Alas, we were finally able to play Minecraft.</p>
]]></content:encoded>
			<wfw:commentRss>https://blog.razb.me/networking-minecraft-on-an-inaccessible-server/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">28</post-id>	</item>
		<item>
		<title>Ghost Classes</title>
		<link>https://blog.razb.me/hello-world/</link>
		<comments>https://blog.razb.me/hello-world/#respond</comments>
		<pubDate>Sat, 12 Mar 2016 06:01:33 +0000</pubDate>
		<dc:creator><![CDATA[Raz]]></dc:creator>
				<category><![CDATA[Objective-C]]></category>
		<category><![CDATA[classes]]></category>
		<category><![CDATA[ghost]]></category>
		<category><![CDATA[load]]></category>
		<category><![CDATA[objective-c]]></category>
		<category><![CDATA[runtime]]></category>
		<category><![CDATA[selector]]></category>
		<category><![CDATA[tips]]></category>
		<category><![CDATA[tricks]]></category>

		<guid isPermaLink="false">http://razb.me/?p=1</guid>
		<description><![CDATA[By exploiting a property of the Objective-C runtime, it’s possible to have a class living and breathing in memory without it ever have been imported, allocated, nor initialized anywhere else in the code base. The property in question is the +load message that is sent to every NSObject shortly after<a class="moretag" href="https://blog.razb.me/hello-world/"> Read more&#8230;</a>]]></description>
				<content:encoded><![CDATA[<p>By exploiting a property of the Objective-C runtime, it’s possible to have a class living and breathing in memory without it ever have been imported, allocated, nor initialized anywhere else in the code base. The property in question is the +load message that is sent to every NSObject shortly after a class is loaded into memory. Consider the following implementation of a hypothetical class called MyClass:</p><pre class="crayon-plain-tag">@implementation MyClass

+ (void)load {
    [[self sharedInstance] run];
}

+ (instancetype)sharedInstance {
    static MyClass *sharedClass;
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        sharedClass = [self new];
    });
    return sharedClass;
}

- (void)run {
    // Do stuff
}

@end</pre><p>Upon MyClass getting loaded into memory, +load is called by the runtime, which allocates, instantiates, and retains an instance of MyClass and then calls -run to do some arbitrary work. MyClass is not #imported from anywhere else, and it is also not retained by anyone else either. It’s there but you can’t see it.</p>
<p>In practice this is probably a bad idea because of the sneaky nature of things. So have a good reason before deciding to use something like this.</p>
]]></content:encoded>
			<wfw:commentRss>https://blog.razb.me/hello-world/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
	<post-id xmlns="com-wordpress:feed-additions:1">1</post-id>	</item>
	</channel>
</rss>
